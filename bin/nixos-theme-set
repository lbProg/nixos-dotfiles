#!/usr/bin/env bash

THEMES_DIR="/home/lucien/.config/theming/themes/"
CURRENT_THEME_DIR="/home/lucien/.config/theming/current/theme"

THEME_NAME=$(echo "$1" | sed -E 's/<[^>]+>//g' | tr '[:upper:]' '[:lower:]' | tr ' ' '-')
THEME_PATH="$THEMES_DIR/$THEME_NAME"

# Check if the theme entered exists
if [[ ! -d "$THEME_PATH" ]]; then
  echo "Theme '$THEME_NAME' does not exist in $THEMES_DIR"
  exit 1
fi

# Update theme symlinks
find "$CURRENT_THEME_DIR" -type l -delete
ln -nsf "$THEME_PATH/"*"" "$CURRENT_THEME_DIR"
ln -nsf "/home/lucien/.config/theming/current/theme/btop.theme" "/home/lucien/.config/btop/themes/btop.theme"
ln -nsf "/home/lucien/.config/theming/current/theme/neovim.lua" "/home/lucien/.config/nvim/lua/plugins/neovim.lua"

nixos-theme-bg-next

nixos-restart-app waybar

hyprctl reload
makoctl reload

pkill -SIGUSR2 btop
nixos-restart-nvim
nixos-theme-set-terminal
nixos-theme-set-gnome
